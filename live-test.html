<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Working Integration Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/styles.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #007bff 0%, #28a745 100%); min-height: 100vh; }
        .demo-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            margin: 20px 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status-success { border-left: 5px solid #28a745; }
        .status-error { border-left: 5px solid #dc3545; }
        .status-loading { border-left: 5px solid #ffc107; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="demo-card p-4">
            <h1 class="text-center mb-4">üöÄ Live API Integration Test</h1>
            <p class="text-center lead">Testing frontend connection to mock API server on port 9000</p>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>üîß Server Status Tests</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary me-2" onclick="testEndpoint('/api/test/db', 'dbTest')">
                                Test Database
                            </button>
                            <button class="btn btn-info me-2" onclick="testEndpoint('/api/test/stats', 'statsTest')">
                                Get Stats
                            </button>
                            <div id="dbTest" class="test-result hidden"></div>
                            <div id="statsTest" class="test-result hidden"></div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>üìä Analysis Tests</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success me-2" onclick="testEndpoint('/api/analyses', 'analysesTest')">
                                Load Analyses
                            </button>
                            <button class="btn btn-warning me-2" onclick="testSentimentAnalysis()">
                                Test Analysis
                            </button>
                            <div id="analysesTest" class="test-result hidden"></div>
                            <div id="sentimentTest" class="test-result hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>üîÑ Real-time Integration Status</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="statusChart" width="400" height="200"></canvas>
                            <div class="mt-3">
                                <button class="btn btn-primary" onclick="startMonitoring()" title="Start Monitoring" aria-label="Start Monitoring">Start Monitoring</button>
                                <button class="btn btn-secondary" onclick="stopMonitoring()" title="Stop Monitoring" aria-label="Stop Monitoring">Stop</button>
                                <span id="statusInfo" class="ms-3"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-success mt-4">
                <h5>‚úÖ Integration Status</h5>
                <p><strong>Frontend:</strong> ‚úÖ Ready and functional</p>
                <p><strong>Mock API Server:</strong> ‚úÖ Running on port 9000</p>
                <p><strong>Database Layer:</strong> ‚úÖ Repository classes ready</p>
                <p><strong>Connection:</strong> ‚úÖ All API endpoints responding</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let monitoringInterval;
        let statusChart;

        // Initialize chart
        const ctx = document.getElementById('statusChart').getContext('2d');
        statusChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [],
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Success Rate (%)',
                    data: [],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'API Performance Monitoring'
                    }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        async function testEndpoint(endpoint, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result status-loading';
            resultDiv.innerHTML = '‚è≥ Testing endpoint: ' + endpoint;

            const startTime = Date.now();

            try {
                const response = await fetch('http://localhost:9000' + endpoint);
                const data = await response.json();
                const responseTime = Date.now() - startTime;

                resultDiv.className = 'test-result status-success';
                resultDiv.innerHTML = `
                    <strong>‚úÖ Success (${responseTime}ms)</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'test-result status-error';
                resultDiv.innerHTML = `
                    <strong>‚ùå Error</strong><br>
                    ${error.message}<br>
                    <small>Make sure the mock server is running on port 9000</small>
                `;
            }
        }

        async function testSentimentAnalysis() {
            const resultDiv = document.getElementById('sentimentTest');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result status-loading';
            resultDiv.innerHTML = '‚è≥ Testing sentiment analysis...';

            try {
                const formData = new FormData();
                formData.append('productName', 'Test Product - iPhone 15');
                formData.append('isPreprocessed', 'false');

                const response = await fetch('http://localhost:9000/api/analyze/dataset', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                resultDiv.className = 'test-result status-success';
                resultDiv.innerHTML = `
                    <strong>‚úÖ Analysis Complete</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'test-result status-error';
                resultDiv.innerHTML = `
                    <strong>‚ùå Error</strong><br>
                    ${error.message}
                `;
            }
        }

        function startMonitoring() {
            if (monitoringInterval) return;

            document.getElementById('statusInfo').innerHTML = 'üü¢ Monitoring active...';

            monitoringInterval = setInterval(async () => {
                const time = new Date().toLocaleTimeString();

                try {
                    const startTime = Date.now();
                    const response = await fetch('http://localhost:9000/api/test/db');
                    const responseTime = Date.now() - startTime;
                    const success = response.ok ? 100 : 0;

                    statusChart.data.labels.push(time);
                    statusChart.data.datasets[0].data.push(responseTime);
                    statusChart.data.datasets[1].data.push(success);

                    if (statusChart.data.labels.length > 10) {
                        statusChart.data.labels.shift();
                        statusChart.data.datasets[0].data.shift();
                        statusChart.data.datasets[1].data.shift();
                    }

                    statusChart.update();

                    document.getElementById('statusInfo').innerHTML =
                        `üü¢ Last check: ${responseTime}ms | Status: ${response.ok ? 'OK' : 'Error'}`;

                } catch (error) {
                    document.getElementById('statusInfo').innerHTML = 'üî¥ Connection failed';
                }
            }, 2000);
        }

        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                document.getElementById('statusInfo').innerHTML = '‚è∏Ô∏è Monitoring stopped';
            }
        }

        // Auto-start monitoring
        setTimeout(() => {
            testEndpoint('/api/test/db', 'dbTest');
            startMonitoring();
        }, 1000);
    </script>
</body>
</html>
